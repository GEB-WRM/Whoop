
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WHOOP Analytics Dashboard</title>
    
    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-annotation/2.1.0/chartjs-plugin-annotation.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --bg-primary: #0a0e1a;
            --bg-secondary: #111827;
            --bg-tertiary: #1a2332;
            --text-primary: #ffffff;
            --text-secondary: #a0a0a0;
            --text-dim: #6b7280;
            --accent-primary: #00ff88;
            --accent-secondary: #00ddff;
            --accent-danger: #ff3366;
            --border-color: #2d3748;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
        }
        
        .header {
            background: var(--bg-secondary);
            padding: 1.5rem 2rem;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-left h1 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-secondary);
            letter-spacing: 0.05em;
        }
        
        .header-left p {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }
        
        .upload-zone {
            background: rgba(0, 221, 255, 0.05);
            border: 2px dashed var(--accent-secondary);
            border-radius: 8px;
            padding: 0.8rem 1.5rem;
            color: var(--text-secondary);
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            min-width: 200px;
        }
        
        .upload-zone:hover {
            background: rgba(0, 221, 255, 0.1);
            border-color: var(--accent-primary);
            box-shadow: 0 0 15px rgba(0, 221, 255, 0.3);
        }
        
        .upload-zone.drag-over {
            background: rgba(0, 221, 255, 0.2);
            border-color: var(--accent-primary);
            transform: scale(1.02);
        }
        
        .upload-zone-title {
            font-weight: 700;
            color: var(--accent-secondary);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 0.3rem;
        }
        
        .upload-zone-hint {
            font-size: 0.65rem;
            color: var(--text-dim);
        }
        
        .header-right {
            text-align: right;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }
        
        .tabs {
            background: var(--bg-secondary);
            display: flex;
            gap: 0.5rem;
            padding: 1rem 2rem;
            border-bottom: 1px solid var(--border-color);
        }
        
        .tab {
            background: none;
            border: none;
            color: var(--text-secondary);
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .tab:hover {
            background: rgba(0, 221, 255, 0.1);
            color: var(--accent-secondary);
        }
        
        .tab.active {
            background: var(--accent-secondary);
            color: var(--bg-primary);
        }
        
        .content {
            padding: 2rem;
            max-width: 1800px;
            margin: 0 auto;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .chart-container {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
        }
        
        .chart-wrapper {
            position: relative;
            height: 400px;
        }
        
        .metric-card {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: var(--shadow);
        }
        
        .metric-card h3 {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }
        
        .metric-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--accent-primary);
            margin: 0.5rem 0;
        }
        
        .metric-label {
            font-size: 0.75rem;
            color: var(--text-dim);
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .goals-section {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem 2rem;
            margin-bottom: 2rem;
            text-align: center;
            display: flex;
            align-items: center;
            gap: 2rem;
        }
        
        .goals-section h3 {
            margin: 0 !important;
            white-space: nowrap;
        }
        
        .goals-content {
            flex: 1;
        }
        
        .goals-input-group {
            display: flex;
            gap: 1rem;
            align-items: center;
            justify-content: center;
            margin-bottom: 0.5rem;
        }
        
        .goals-input-group label {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }
        
        .goals-input-group input {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 0.4rem 0.6rem;
            color: var(--text-primary);
            font-size: 0.85rem;
            width: 120px;
        }
        
        .goals-input-group button {
            background: var(--accent-secondary);
            border: none;
            border-radius: 4px;
            padding: 0.5rem 1rem;
            color: var(--bg-primary);
            font-size: 0.8rem;
            font-weight: 700;
            cursor: pointer;
            text-transform: uppercase;
            transition: all 0.3s ease;
        }
        
        .goals-input-group button:hover {
            background: var(--accent-primary);
            box-shadow: 0 0 10px rgba(0, 221, 255, 0.5);
        }
        
        .goal-result {
            font-size: 1.4rem;
            color: var(--accent-primary);
            font-weight: 700;
            margin-top: 0.5rem;
        }
        
        .view-toggle-btn {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 0.4rem 0.8rem;
            color: var(--text-secondary);
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        .view-toggle-btn:hover {
            border-color: var(--accent-secondary);
            color: var(--accent-secondary);
        }
        
        .view-toggle-btn.active {
            background: var(--accent-secondary);
            border-color: var(--accent-secondary);
            color: var(--bg-primary);
        }

        /* Journal Gauge Styles */
        .journal-gauge {
            position: relative;
            width: 120px;
            height: 60px;
            margin: 1rem auto;
        }
        
        .journal-gauge-arc {
            width: 120px;
            height: 60px;
            border-radius: 120px 120px 0 0;
            background: linear-gradient(to right, #666 0%, #666 50%, #666 100%);
            position: relative;
            overflow: hidden;
        }
        
        .journal-gauge-arc::before {
            content: '';
            position: absolute;
            width: 100px;
            height: 50px;
            background: var(--bg-tertiary);
            border-radius: 100px 100px 0 0;
            top: 10px;
            left: 10px;
        }
        
        .journal-needle {
            position: absolute;
            width: 2px;
            height: 50px;
            background: #ff8800;
            bottom: 0;
            left: 50%;
            transform-origin: bottom center;
            transition: transform 0.5s cubic-bezier(0.4, 0.0, 0.2, 1);
            z-index: 10;
        }
        
        .journal-needle::after {
            content: '';
            position: absolute;
            width: 8px;
            height: 8px;
            background: #ff8800;
            border-radius: 50%;
            bottom: -4px;
            left: -3px;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-left">
            <h1>WHOOP ANALYTICS</h1>
            <p>Advanced Performance Tracking & Insights</p>
        </div>
        <div style="display: flex; align-items: center; gap: 2rem;">
            <div class="header-right">
                <div id="user-name" style="display: none;"></div>
                <div id="date-range">Upload data to begin</div>
                <div id="days-count"></div>
            </div>
            <div class="upload-zone" id="upload-zone">
                <div class="upload-zone-title">üìÅ Upload Data</div>
                <div class="upload-zone-hint">Click or drag files here</div>
            </div>
            <input type="file" id="file-input" multiple accept=".xlsx,.csv" style="display: none;">
        </div>
    </div>
    
    <div class="tabs">
        <button class="tab active" data-tab="home">Home</button>
        <button class="tab" data-tab="journal">Journal</button>
        <button class="tab" data-tab="health">Health Trends</button>
        <button class="tab" data-tab="workouts">Workouts</button>
        <button class="tab" data-tab="sleep">Sleep</button>
    </div>
    
    <div class="content">
        <div id="home" class="tab-content active">
            <div class="goals-section">
                <h3 style="color: var(--accent-secondary); font-size: 1.5rem;">Goals</h3>
                <div id="goals-display" class="goals-content"></div>
            </div>
            <div class="chart-container" style="width: 100%; max-width: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h3>HRV Trend</h3>
                    <div style="display: flex; gap: 0.5rem;">
                        <button id="daily-view-btn" class="view-toggle-btn active" onclick="switchHRVView('daily')">Daily</button>
                        <button id="weekly-view-btn" class="view-toggle-btn" onclick="switchHRVView('weekly')">Weekly</button>
                    </div>
                </div>
                <div class="chart-wrapper" style="height: 400px;">
                    <canvas id="home-hrv-chart"></canvas>
                </div>
            </div>
        </div>
        
        <div id="journal" class="tab-content">
            <div id="journal-content">Upload journal data to see insights</div>
        </div>
        
        <div id="health" class="tab-content">
            <div id="health-content">Upload health data to see trends</div>
        </div>
        
        <div id="workouts" class="tab-content">
            <div id="workouts-content">Upload workout data to see analysis</div>
        </div>
        
        <div id="sleep" class="tab-content">
            <div id="sleep-content">Upload sleep data to see patterns</div>
        </div>
    </div>
    
    <script>
        // Global variables
        let journalData = [];
        let physioData = [];
        let workoutData = [];
        let sleepData = [];
        let charts = {};
        let currentHRVView = 'daily';
        
        // Tab switching
        document.querySelector('.tabs').addEventListener('click', function(e) {
            if (e.target.classList.contains('tab')) {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                e.target.classList.add('active');
                const tabName = e.target.getAttribute('data-tab');
                document.getElementById(tabName).classList.add('active');
            }
        });
        
        // Drag and drop upload
        const uploadZone = document.getElementById('upload-zone');
        const fileInput = document.getElementById('file-input');
        
        uploadZone.addEventListener('click', () => fileInput.click());
        
        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.classList.add('drag-over');
        });
        
        uploadZone.addEventListener('dragleave', () => {
            uploadZone.classList.remove('drag-over');
        });
        
        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('drag-over');
            processFiles(e.dataTransfer.files);
        });
        
        fileInput.addEventListener('change', (e) => {
            processFiles(e.target.files);
        });
        
        function processFiles(files) {
            let processed = 0;
            
            Array.from(files).forEach(file => {
                const fileName = file.name.toLowerCase();
                
                if (fileName.includes('journal')) {
                    handleJournalFile(file);
                    processed++;
                } else if (fileName.includes('physiological') || fileName.includes('cycle')) {
                    handlePhysioFile(file);
                    processed++;
                } else if (fileName.includes('workout')) {
                    handleWorkoutFile(file);
                    processed++;
                } else if (fileName.includes('sleep')) {
                    handleSleepFile(file);
                    processed++;
                }
            });
            
            if (processed > 0) {
                setTimeout(() => {
                    const userName = prompt('Enter your name:', 'Your Name') || 'Your Name';
                    document.getElementById('user-name').textContent = userName;
                    document.getElementById('user-name').style.display = 'block';
                    updateHeaderInfo();
                    renderGoals();
                    renderHomeHRVChart();
                }, 1000);
            }
        }
        
        function handleJournalFile(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const workbook = XLSX.read(e.target.result, { type: 'binary' });
                    const sheetName = workbook.SheetNames[0];
                    journalData = XLSX.utils.sheet_to_json(workbook.Sheets[sheetName]);
                    localStorage.setItem('journalData', JSON.stringify(journalData));
                    renderJournal();
                } catch (error) {
                    alert('Error loading journal: ' + error.message);
                }
            };
            reader.readAsBinaryString(file);
        }
        
        function handlePhysioFile(file) {
            Papa.parse(file, {
                header: true,
                complete: function(results) {
                    physioData = results.data.filter(d => d['Cycle start time'] && d['Cycle start time'].trim());
                    localStorage.setItem('physioData', JSON.stringify(physioData));
                    renderHealth();
                    updateHeaderInfo();
                    renderGoals();
                    renderHomeHRVChart();
                }
            });
        }
        
        function handleWorkoutFile(file) {
            Papa.parse(file, {
                header: true,
                complete: function(results) {
                    workoutData = results.data.filter(d => d['Activity name'] && d['Activity name'].trim());
                    localStorage.setItem('workoutData', JSON.stringify(workoutData));
                    renderWorkouts();
                    updateHeaderInfo();
                }
            });
        }
        
        function handleSleepFile(file) {
            Papa.parse(file, {
                header: true,
                complete: function(results) {
                    sleepData = results.data.filter(d => d['Sleep onset'] && d['Sleep onset'].trim());
                    localStorage.setItem('sleepData', JSON.stringify(sleepData));
                    renderSleep();
                    updateHeaderInfo();
                }
            });
        }
        
        function updateHeaderInfo() {
            let allDates = [];
            
            if (physioData.length > 0) {
                physioData.forEach(d => {
                    const date = new Date(d['Cycle start time']);
                    if (!isNaN(date.getTime()) && date.getFullYear() > 2000) {
                        allDates.push(date);
                    }
                });
            }
            
            if (allDates.length > 0) {
                allDates.sort((a, b) => a - b);
                const minDate = allDates[0];
                const maxDate = allDates[allDates.length - 1];
                const daysDiff = Math.ceil((maxDate - minDate) / (1000 * 60 * 60 * 24)) + 1;
                
                document.getElementById('date-range').textContent = 
                    minDate.toLocaleDateString() + ' - ' + maxDate.toLocaleDateString();
                document.getElementById('days-count').innerHTML = '<strong>' + daysDiff + ' days</strong>';
            }
        }
        
        function renderGoals() {
            const goals = loadGoals();
            const currentHRV = physioData.length > 0 ? calculateAverage(physioData, 'Heart rate variability (ms)') : 0;
            
            if (goals.targetHRV && goals.targetDate) {
                const today = new Date();
                const targetDate = new Date(goals.targetDate);
                const daysRemaining = Math.ceil((targetDate - today) / (1000 * 60 * 60 * 24));
                const hrvDifference = goals.targetHRV - currentHRV;
                const dailyChangeNeeded = daysRemaining > 0 ? hrvDifference / daysRemaining : 0;
                
                const formattedDate = (targetDate.getMonth() + 1).toString().padStart(2, '0') + '/' +
                                     targetDate.getDate().toString().padStart(2, '0') + '/' +
                                     targetDate.getFullYear();
                
                document.getElementById('goals-display').innerHTML = 
                    '<div style="font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 0.5rem;">' +
                    'Current Avg HRV: ' + currentHRV.toFixed(0) + 'ms</div>' +
                    '<div class="goal-result">Daily Change Needed: ' + (dailyChangeNeeded > 0 ? '+' : '') + 
                    dailyChangeNeeded.toFixed(2) + ' ms/day to reach ' + goals.targetHRV + 'ms by ' + formattedDate + '</div>' +
                    '<button onclick="clearGoals()" style="margin-top: 0.5rem; background: rgba(255, 51, 102, 0.2); ' +
                    'color: var(--accent-danger); border: 1px solid var(--accent-danger); padding: 0.3rem 0.6rem; ' +
                    'border-radius: 4px; cursor: pointer; font-size: 0.65rem;">Clear Goals</button>';
            } else {
                document.getElementById('goals-display').innerHTML = 
                    '<div class="goals-input-group">' +
                    '<label>Target Avg HRV:</label>' +
                    '<input type="number" id="target-hrv" placeholder="e.g., 80">' +
                    '<label>Target Date (mm/dd/yyyy):</label>' +
                    '<input type="text" id="target-date" placeholder="03/15/2026">' +
                    '<button onclick="saveGoals()">Set Goal</button>' +
                    '</div>';
            }
        }
        
        function loadGoals() {
            try {
                const saved = localStorage.getItem('whoopGoals');
                return saved ? JSON.parse(saved) : {};
            } catch (e) {
                return {};
            }
        }
        
        function saveGoals() {
            const targetHRV = parseFloat(document.getElementById('target-hrv').value);
            const targetDateInput = document.getElementById('target-date').value;
            
            if (!targetHRV || !targetDateInput) {
                alert('Please enter both target HRV and target date');
                return;
            }
            
            const datePattern = /^(\d{2})\/(\d{2})\/(\d{4})$/;
            const match = targetDateInput.match(datePattern);
            
            if (!match) {
                alert('Please enter date in mm/dd/yyyy format (e.g., 03/15/2026)');
                return;
            }
            
            const isoDate = match[3] + '-' + match[1] + '-' + match[2];
            const goals = { targetHRV: targetHRV, targetDate: isoDate };
            
            localStorage.setItem('whoopGoals', JSON.stringify(goals));
            renderGoals();
        }
        
        function clearGoals() {
            if (confirm('Are you sure you want to clear your goals?')) {
                localStorage.removeItem('whoopGoals');
                renderGoals();
            }
        }
        
        function switchHRVView(view) {
            currentHRVView = view;
            document.getElementById('daily-view-btn').classList.toggle('active', view === 'daily');
            document.getElementById('weekly-view-btn').classList.toggle('active', view === 'weekly');
            renderHomeHRVChart();
        }
        
        function renderHomeHRVChart() {
            if (physioData.length === 0) {
                return;
            }
            
            const validData = physioData.filter(d => d['Cycle start time'] && d['Cycle start time'].trim());
            let chartData;
            
            if (currentHRVView === 'daily') {
                chartData = validData.map(d => ({
                    date: new Date(d['Cycle start time']),
                    hrv: parseFloat(d['Heart rate variability (ms)']) || 0
                })).filter(d => d.hrv > 0);
            } else {
                const weeklyData = {};
                validData.forEach(d => {
                    const date = new Date(d['Cycle start time']);
                    const weekStart = new Date(date);
                    weekStart.setDate(date.getDate() - date.getDay());
                    const weekKey = weekStart.toISOString().split('T')[0];
                    
                    if (!weeklyData[weekKey]) {
                        weeklyData[weekKey] = [];
                    }
                    const hrv = parseFloat(d['Heart rate variability (ms)']);
                    if (hrv > 0) {
                        weeklyData[weekKey].push(hrv);
                    }
                });
                
                chartData = Object.keys(weeklyData).map(weekKey => ({
                    date: new Date(weekKey),
                    hrv: weeklyData[weekKey].reduce((a, b) => a + b, 0) / weeklyData[weekKey].length
                })).sort((a, b) => a.date - b.date);
            }
            
            // Reverse data so oldest is on left, newest on right
            chartData.reverse();
            const labels = chartData.map(d => d.date.toLocaleDateString());
            const hrvValues = chartData.map(d => d.hrv);
            
            const ctx = document.getElementById('home-hrv-chart');
            if (!ctx) return;
            
            if (charts['home-hrv-chart']) {
                charts['home-hrv-chart'].destroy();
            }
            
            // Calculate regression line on REVERSED data (oldest to newest)
            const n = hrvValues.length;
            const xSum = (n * (n - 1)) / 2;
            const ySum = hrvValues.reduce((a, b) => a + b, 0);
            const xySum = hrvValues.reduce((sum, y, i) => sum + (i * y), 0);
            const xSquareSum = (n * (n - 1) * (2 * n - 1)) / 6;
            const m = (n * xySum - xSum * ySum) / (n * xSquareSum - xSum * xSum);
            const b = (ySum - m * xSum) / n;
            
            // NOW calculate slope for display (m is the slope per data point)
            const slopePerUnit = currentHRVView === 'daily' ? m : m * 7;
            const slopeColor = slopePerUnit > 0 ? '#00ff88' : slopePerUnit < 0 ? '#ff3366' : '#a0a0a0';
            const unit = currentHRVView === 'daily' ? 'day' : 'week';
            
            const regressionLine = hrvValues.map((_, i) => m * i + b);
            
            charts['home-hrv-chart'] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: currentHRVView === 'daily' ? 'Daily HRV' : 'Weekly Avg HRV',
                        data: hrvValues,
                        borderColor: '#00ddff',
                        backgroundColor: 'rgba(0, 221, 255, 0.2)',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true,
                        pointRadius: currentHRVView === 'daily' ? 3 : 5,
                        pointHoverRadius: 6,
                        pointBackgroundColor: '#00ddff'
                    }, {
                        label: 'Trend',
                        data: regressionLine,
                        borderColor: slopeColor,
                        borderWidth: 2,
                        borderDash: [5, 5],
                        tension: 0,
                        fill: false,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: {
                            grid: { color: 'rgba(255, 255, 255, 0.05)' },
                            ticks: { 
                                color: '#a0a0a0',
                                maxTicksLimit: currentHRVView === 'daily' ? 10 : 20
                            }
                        },
                        y: {
                            grid: { color: 'rgba(255, 255, 255, 0.05)' },
                            ticks: { color: '#a0a0a0' }
                        }
                    },
                    plugins: {
                        annotation: {
                            annotations: {
                                slope: {
                                    type: 'label',
                                    xValue: hrvValues.length - 1,
                                    yValue: regressionLine[regressionLine.length - 1],
                                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                    content: [(slopePerUnit >= 0 ? '+' : '') + slopePerUnit.toFixed(2) + ' ms/' + unit],
                                    color: slopeColor,
                                    font: {
                                        size: 18,
                                        weight: 'bold'
                                    },
                                    padding: 6,
                                    borderRadius: 4,
                                    position: 'end'
                                }
                            }
                        }
                    }
                }
            });
        }
        
        function calculateAverage(data, field) {
            const values = data.map(d => parseFloat(d[field])).filter(v => !isNaN(v));
            return values.length > 0 ? values.reduce((a, b) => a + b, 0) / values.length : 0;
        }
        


        function calculateSlope(data, field, convert) {
            if (data.length < 2) return 0;
            
            let values = data.map(d => parseFloat(d[field])).filter(v => !isNaN(v));
            if (convert) values = values.map(v => v / 60);
            
            if (values.length < 2) return 0;
            
            const n = values.length;
            const xSum = (n * (n - 1)) / 2;
            const ySum = values.reduce((a, b) => a + b, 0);
            const xySum = values.reduce((sum, y, i) => sum + (i * y), 0);
            const xSquareSum = (n * (n - 1) * (2 * n - 1)) / 6;
            
            const slope = (n * xySum - xSum * ySum) / (n * xSquareSum - xSum * xSum);
            return slope;
        }
        

        function generateJournalInsights(data, stats) {
            const insights = [];
            const alarms = [];
            
            // Group data by date to find correlations
            const dateMap = {};
            data.forEach(entry => {
                const date = entry['Cycle start time'];
                if (!dateMap[date]) dateMap[date] = {};
                const question = entry['Question text'];
                const answered = entry['Answered yes'];
                dateMap[date][question] = (answered === true || answered === 'TRUE' || answered === 'true');
            });
            
            const questions = Object.keys(stats);
            
            // Find positive correlations (when A happens, B also happens >70% of time)
            for (let i = 0; i < questions.length; i++) {
                for (let j = i + 1; j < questions.length; j++) {
                    const q1 = questions[i];
                    const q2 = questions[j];
                    
                    let bothYes = 0;
                    let q1YesCount = 0;
                    
                    Object.keys(dateMap).forEach(date => {
                        if (dateMap[date][q1] === true) {
                            q1YesCount++;
                            if (dateMap[date][q2] === true) {
                                bothYes++;
                            }
                        }
                    });
                    
                    if (q1YesCount >= 3) {
                        const correlation = (bothYes / q1YesCount) * 100;
                        if (correlation >= 70) {
                            insights.push('<strong>Pattern Found:</strong> When you ' + q1.toLowerCase() + 
                                        ', you also ' + q2.toLowerCase() + ' ' + correlation.toFixed(0) + '% of the time');
                        }
                    }
                }
            }
            
            // Find areas for improvement (habits done less than 50% of time)
            questions.forEach(q => {
                const s = stats[q];
                const total = s.yes + s.no;
                const yesPercent = total > 0 ? (s.yes / total) * 100 : 0;
                
                // Look for positive habits being done less than 50%
                const positiveHabits = ['exercise', 'breakfast', 'gratitude', 'hydrat', 'sleep', 'protein', 'vitamin'];
                const isPositiveHabit = positiveHabits.some(h => q.toLowerCase().includes(h));
                
                if (isPositiveHabit && yesPercent < 50 && total >= 5) {
                    alarms.push('<strong>Opportunity:</strong> You only ' + q.toLowerCase() + ' ' + 
                              yesPercent.toFixed(0) + '% of the time - try to increase this');
                }
                
                // Look for negative symptoms happening frequently
                const negativeSymptoms = ['bloat', 'gas', 'headache', 'pain', 'tired', 'stress', 'anxiety'];
                const isNegativeSymptom = negativeSymptoms.some(h => q.toLowerCase().includes(h));
                
                if (isNegativeSymptom && yesPercent > 50 && total >= 5) {
                    alarms.push('<strong>Watch Out:</strong> You experience ' + q.toLowerCase() + ' ' + 
                              yesPercent.toFixed(0) + '% of the time - consider addressing this');
                }
            });
            
            return {
                insights: insights.length > 0 ? insights : ['<strong>Keep Tracking:</strong> More data needed to find patterns'],
                alarms: alarms.length > 0 ? alarms : ['<strong>Looking Good:</strong> No major concerns detected']
            };
        }
        
        // Journal rendering
        let currentInsightIndex = 0;
        let currentAlarmIndex = 0;
        let allInsights = [];
        let allAlarms = [];
        
        function refreshInsight() {
            if (allInsights.length === 0) return;
            currentInsightIndex = (currentInsightIndex + 1) % allInsights.length;
            document.getElementById('insight-content').innerHTML = allInsights[currentInsightIndex];
        }
        
        function refreshAlarm() {
            if (allAlarms.length === 0) return;
            currentAlarmIndex = (currentAlarmIndex + 1) % allAlarms.length;
            document.getElementById('alarm-content').innerHTML = allAlarms[currentAlarmIndex];
        }
        
        function renderJournal() {
            if (journalData.length === 0) return;
            
            const filtered = journalData.filter(e => {
                const q = (e['Question text'] || '').toLowerCase();
                return !q.includes('masturbat');
            });
            
            const stats = {};
            filtered.forEach(e => {
                const q = e['Question text'];
                const ans = e['Answered yes'];
                if (!stats[q]) stats[q] = { yes: 0, no: 0 };
                if (ans === true || ans === 'TRUE' || ans === 'true') {
                    stats[q].yes++;
                } else {
                    stats[q].no++;
                }
            });
            
            // Generate insights
            const insightsData = generateJournalInsights(filtered, stats);
            allInsights = insightsData.insights;
            allAlarms = insightsData.alarms;
            currentInsightIndex = Math.floor(Math.random() * allInsights.length);
            currentAlarmIndex = Math.floor(Math.random() * allAlarms.length);
            
            let html = '<div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.5rem; margin-bottom: 2rem;">';
            
            // Interesting Insights
            html += '<div style="background: var(--bg-tertiary); border-left: 4px solid var(--accent-secondary); ' +
                   'border-radius: 8px; padding: 1.5rem;">' +
                   '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">' +
                   '<h3 style="color: var(--accent-secondary); margin: 0;">üîó Interesting Insights</h3>' +
                   '<button onclick="refreshInsight()" style="background: var(--accent-secondary); border: none; ' +
                   'border-radius: 4px; padding: 0.4rem 0.8rem; color: var(--bg-primary); cursor: pointer; ' +
                   'font-size: 0.75rem; font-weight: bold;">‚Üª Refresh</button></div>' +
                   '<div id="insight-content" style="color: var(--text-primary);">' + allInsights[currentInsightIndex] + '</div></div>';
            
            // Alarms
            html += '<div style="background: var(--bg-tertiary); border-left: 4px solid var(--accent-danger); ' +
                   'border-radius: 8px; padding: 1.5rem;">' +
                   '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">' +
                   '<h3 style="color: var(--accent-danger); margin: 0;">‚ö† Focus Areas</h3>' +
                   '<button onclick="refreshAlarm()" style="background: var(--accent-danger); border: none; ' +
                   'border-radius: 4px; padding: 0.4rem 0.8rem; color: white; cursor: pointer; ' +
                   'font-size: 0.75rem; font-weight: bold;">‚Üª Refresh</button></div>' +
                   '<div id="alarm-content" style="color: var(--text-primary);">' + allAlarms[currentAlarmIndex] + '</div></div>';
            
            html += '</div>';
            
            html += '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1rem;">';
            
            Object.keys(stats).forEach(q => {
                const s = stats[q];
                const total = s.yes + s.no;
                const yesPercent = total > 0 ? ((s.yes / total) * 100).toFixed(0) : 0;
                
                // Calculate needle rotation: -90deg (No/left) to +90deg (Yes/right)
                const needleRotation = (yesPercent / 100) * 180 - 90;
                
                html += '<div style="background: var(--bg-tertiary); border: 1px solid var(--border-color); ' +
                       'border-radius: 12px; padding: 1.5rem;">' +
                       '<h4 style="margin-bottom: 1rem; color: var(--text-primary);">' + q + '</h4>' +
                       '<div class="journal-gauge">' +
                       '<div class="journal-gauge-arc"></div>' +
                       '<div class="journal-needle" style="transform: rotate(' + needleRotation + 'deg);"></div>' +
                       '</div>' +
                       '<div style="display: flex; justify-content: space-around; margin-top: 1rem;">' +
                       '<div style="text-align: center;"><div style="font-size: 1.5rem; font-weight: bold; color: ' + 
                       (s.no > s.yes ? 'var(--accent-primary)' : 'var(--text-secondary)') + ';">' + s.no + '</div>' +
                       '<div style="font-size: 0.75rem; color: var(--text-dim);">No (' + (100 - yesPercent) + '%)</div></div>' +
                       '<div style="text-align: center;"><div style="font-size: 1.5rem; font-weight: bold; color: ' + 
                       (s.yes >= s.no ? 'var(--accent-primary)' : 'var(--text-secondary)') + ';">' + s.yes + '</div>' +
                       '<div style="font-size: 0.75rem; color: var(--text-dim);">Yes (' + yesPercent + '%)</div></div>' +
                       '</div></div>';
            });
            
            html += '</div>';
            document.getElementById('journal-content').innerHTML = html;
        }
        
        // Health trends rendering
        function renderHealth() {
            if (physioData.length === 0) return;
            
            const validData = physioData.filter(d => d['Cycle start time'] && d['Cycle start time'].trim());
            
            const avgRecovery = calculateAverage(validData, 'Recovery score %');
            const avgHRV = calculateAverage(validData, 'Heart rate variability (ms)');
            const avgRHR = calculateAverage(validData, 'Resting heart rate (bpm)');
            const avgStrain = calculateAverage(validData, 'Day Strain');
            
            let html = '<div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.5rem; margin-bottom: 2rem;">';
            
            html += '<div class="metric-card"><h3>Avg Recovery</h3>' +
                   '<div class="metric-value">' + avgRecovery.toFixed(0) + '%</div>' +
                   '<div class="metric-label">Recovery Score</div></div>';
                   
            html += '<div class="metric-card"><h3>Avg HRV</h3>' +
                   '<div class="metric-value">' + avgHRV.toFixed(0) + '</div>' +
                   '<div class="metric-label">Milliseconds</div></div>';
                   
            html += '<div class="metric-card"><h3>Avg RHR</h3>' +
                   '<div class="metric-value">' + avgRHR.toFixed(0) + '</div>' +
                   '<div class="metric-label">Beats per Minute</div></div>';
                   
            html += '<div class="metric-card"><h3>Avg Strain</h3>' +
                   '<div class="metric-value">' + avgStrain.toFixed(1) + '</div>' +
                   '<div class="metric-label">Day Strain</div></div>';
            
            html += '</div>';
            
            // Add charts
            const charts = [
                { id: 'recovery', title: 'Recovery Score', field: 'Recovery score %', color: '#00ff88', higherIsBetter: true },
                { id: 'hrv', title: 'HRV', field: 'Heart rate variability (ms)', color: '#00ddff', higherIsBetter: true },
                { id: 'rhr', title: 'Resting Heart Rate', field: 'Resting heart rate (bpm)', color: '#ff3366', higherIsBetter: false },
                { id: 'strain', title: 'Day Strain', field: 'Day Strain', color: '#ffaa00', higherIsBetter: true }
            ];
            
            charts.forEach(cfg => {
                html += '<div class="chart-container" style="width: 100%; max-width: none;">' +
                       '<h3>' + cfg.title + '</h3>' +
                       '<div class="chart-wrapper" style="height: 300px;">' +
                       '<canvas id="health-' + cfg.id + '"></canvas></div></div>';
            });
            
            document.getElementById('health-content').innerHTML = html;
            
            // Render charts
            setTimeout(() => {
                charts.forEach(cfg => {
                    createHealthChart('health-' + cfg.id, validData, cfg);
                });
            }, 100);
        }
        
        function createHealthChart(canvasId, data, config) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return;
            
            // Reverse data so oldest is on left
            const reversed = [...data].reverse();
            const labels = reversed.map(d => new Date(d['Cycle start time']).toLocaleDateString());
            const values = reversed.map(d => parseFloat(d[config.field])).filter(v => !isNaN(v));
            
            if (charts[canvasId]) {
                charts[canvasId].destroy();
            }
            
            // Calculate regression line
            const n = values.length;
            const xSum = (n * (n - 1)) / 2;
            const ySum = values.reduce((a, b) => a + b, 0);
            const xySum = values.reduce((sum, y, i) => sum + (i * y), 0);
            const xSquareSum = (n * (n - 1) * (2 * n - 1)) / 6;
            const m = (n * xySum - xSum * ySum) / (n * xSquareSum - xSum * xSum);
            const b = (ySum - m * xSum) / n;
            const regressionLine = values.map((_, i) => m * i + b);
            
            // Color based on whether higher is better for this metric
            let slopeColor;
            if (config.higherIsBetter) {
                slopeColor = m > 0 ? '#00ff88' : m < 0 ? '#ff3366' : '#a0a0a0';
            } else {
                slopeColor = m < 0 ? '#00ff88' : m > 0 ? '#ff3366' : '#a0a0a0';
            }
            
            charts[canvasId] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: config.title,
                        data: values,
                        borderColor: config.color,
                        backgroundColor: 'transparent',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: false,
                        pointRadius: 2
                    }, {
                        label: 'Trend',
                        data: regressionLine,
                        borderColor: slopeColor,
                        borderWidth: 2,
                        borderDash: [5, 5],
                        tension: 0,
                        fill: false,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: {
                            grid: { color: 'rgba(255, 255, 255, 0.05)' },
                            ticks: { color: '#a0a0a0', maxTicksLimit: 15 }
                        },
                        y: {
                            grid: { color: 'rgba(255, 255, 255, 0.05)' },
                            ticks: { color: '#a0a0a0' }
                        }
                    },
                    plugins: {
                        annotation: {
                            annotations: {
                                slope: {
                                    type: 'label',
                                    xValue: values.length - 1,
                                    yValue: regressionLine[regressionLine.length - 1],
                                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                    content: [(m > 0 ? '+' : '') + m.toFixed(2) + '/day'],
                                    color: slopeColor,
                                    font: { size: 18, weight: 'bold' },
                                    padding: 6,
                                    borderRadius: 4,
                                    position: 'end'
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Workouts rendering
        function renderWorkouts() {
            if (workoutData.length === 0) return;
            
            const validData = workoutData.filter(d => d['Activity name'] && d['Activity name'].trim());
            const activities = {};
            
            validData.forEach(w => {
                const name = w['Activity name'];
                if (!activities[name]) activities[name] = [];
                activities[name].push(w);
            });
            
            const sorted = Object.entries(activities).sort((a, b) => b[1].length - a[1].length);
            
            let html = '';
                        
            // Add calories per minute bar chart
            const calPerMin = {};
            sorted.forEach(([name, workouts]) => {
                let totalCals = 0;
                let totalMins = 0;
                workouts.forEach(w => {
                    const cals = parseFloat(w['Energy burned (cal)']) || 0;
                    const mins = parseFloat(w['Duration (min)']) || 0;
                    totalCals += cals;
                    totalMins += mins;
                });
                if (totalMins > 0) {
                    calPerMin[name] = totalCals / totalMins;
                }
            });
            
            const sortedCalPerMin = Object.entries(calPerMin).sort((a, b) => a[1] - b[1]);
            
            if (sortedCalPerMin.length > 0) {
                const maxCal = Math.max(...sortedCalPerMin.map(x => x[1]));
                html += '<div class="chart-container" style="margin-bottom: 2rem;">' +
                       '<h3>Calories Per Minute by Activity</h3>' +
                       '<div style="display: flex; align-items: flex-end; justify-content: space-around; ' +
                       'padding: 2rem 1rem; height: 300px; gap: 0.5rem;">';
                
                sortedCalPerMin.forEach(([name, cal]) => {
                    const heightPercent = (cal / maxCal) * 100;
                    const heightPx = (cal / maxCal) * 250; // Use pixels for better visual scaling
                    html += '<div style="display: flex; flex-direction: column; align-items: center; flex: 1;">' +
                           '<div style="flex: 1; display: flex; align-items: flex-end; width: 100%;">' +
                           '<div style="background: var(--accent-secondary); width: 100%; max-width: 60px; margin: 0 auto; ' +
                           'height: ' + heightPx + 'px; border-radius: 4px 4px 0 0; min-height: 30px; position: relative; ' +
                           'display: flex; align-items: center; justify-content: center;">' +
                           '<span style="color: var(--bg-primary); font-weight: bold; font-size: 0.85rem;">' + cal.toFixed(1) + '</span>' +
                           '</div></div>' +
                           '<div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.5rem; font-weight: 600; ' +
                           'text-align: center; word-wrap: break-word; max-width: 90px; min-height: 2.5rem; ' +
                           'display: flex; align-items: flex-start; justify-content: center;">' + name + '</div>' +
                           '</div>';
                });
                
                html += '</div></div>';
            }

            html += '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">';
            
            sorted.forEach(([name, workouts]) => {
                const avgDuration = calculateAverage(workouts, 'Duration (min)');
                const avgStrain = calculateAverage(workouts, 'Activity Strain');
                const avgCals = calculateAverage(workouts, 'Energy burned (cal)');
                
                html += '<div style="background: var(--bg-tertiary); border: 1px solid var(--border-color); ' +
                       'border-radius: 12px; padding: 1.5rem;">' +
                       '<h4 style="color: var(--accent-secondary); margin-bottom: 1rem; font-size: 1.2rem;">' + name + '</h4>' +
                       '<div style="color: var(--text-secondary); font-size: 1rem; margin-bottom: 0.5rem;">Total: ' + workouts.length + '</div>' +
                       '<div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; text-align: center;">' +
                       '<div><div style="color: var(--accent-primary); font-size: 2rem; font-weight: bold;">' + avgDuration.toFixed(0) + '</div>' +
                       '<div style="font-size: 0.85rem; color: var(--text-dim);">Avg Min</div></div>' +
                       '<div><div style="color: var(--accent-primary); font-size: 2rem; font-weight: bold;">' + avgStrain.toFixed(1) + '</div>' +
                       '<div style="font-size: 0.85rem; color: var(--text-dim);">Avg Strain</div></div>' +
                       '<div><div style="color: var(--accent-primary); font-size: 2rem; font-weight: bold;">' + avgCals.toFixed(0) + '</div>' +
                       '<div style="font-size: 0.85rem; color: var(--text-dim);">Avg Cals</div></div>' +
                       '</div></div>';
            });
            
            html += '</div>';
            document.getElementById('workouts-content').innerHTML = html;
        }
        
        // Sleep rendering  
        function renderSleep() {
            if (sleepData.length === 0) return;
            
            const validData = sleepData.filter(d => d['Sleep onset'] && d['Sleep onset'].trim());
            const nonNaps = validData.filter(d => 
                d['Nap'] !== 'TRUE' && d['Nap'] !== true && d['Nap'] !== 'true' && d['Nap'] !== '1'
            );
            
            const avgPerf = calculateAverage(nonNaps, 'Sleep performance %');
            const avgDuration = calculateAverage(nonNaps, 'Asleep duration (min)');
            const avgEff = calculateAverage(nonNaps, 'Sleep efficiency %');
            const avgDebt = calculateAverage(nonNaps, 'Sleep debt (min)');
            
            let html = '<div class="dashboard-grid">';
            
            html += '<div class="metric-card"><h3>Avg Performance</h3>' +
                   '<div class="metric-value">' + avgPerf.toFixed(0) + '%</div>' +
                   '<div class="metric-label">Sleep Performance</div></div>';
                   
            html += '<div class="metric-card"><h3>Avg Duration</h3>' +
                   '<div class="metric-value">' + (avgDuration / 60).toFixed(1) + '</div>' +
                   '<div class="metric-label">Hours Asleep</div></div>';
                   
            html += '<div class="metric-card"><h3>Avg Efficiency</h3>' +
                   '<div class="metric-value">' + avgEff.toFixed(0) + '%</div>' +
                   '<div class="metric-label">Sleep Efficiency</div></div>';
                   
            html += '<div class="metric-card"><h3>Avg Debt</h3>' +
                   '<div class="metric-value">' + avgDebt.toFixed(0) + '</div>' +
                   '<div class="metric-label">Minutes</div></div>';
            
            html += '</div>';
            
            // Add charts
            const sleepCharts = [
                { id: 'perf', title: 'Sleep Performance', field: 'Sleep performance %', color: '#00ff88', higherIsBetter: true },
                { id: 'duration', title: 'Sleep Duration (hrs)', field: 'Asleep duration (min)', color: '#00ddff', convert: true, higherIsBetter: true },
                { id: 'efficiency', title: 'Sleep Efficiency', field: 'Sleep efficiency %', color: '#ffaa00', higherIsBetter: true },
                { id: 'debt', title: 'Sleep Debt', field: 'Sleep debt (min)', color: '#ff3366', higherIsBetter: false }
            ];
            
            sleepCharts.forEach(cfg => {
                html += '<div class="chart-container">' +
                       '<h3>' + cfg.title + '</h3>' +
                       '<div class="chart-wrapper"><canvas id="sleep-' + cfg.id + '"></canvas></div></div>';
            });
            
            document.getElementById('sleep-content').innerHTML = html;
            
            // Render charts
            setTimeout(() => {
                sleepCharts.forEach(cfg => {
                    createSleepChart('sleep-' + cfg.id, nonNaps, cfg);
                });
            }, 100);
        }
        
        function createSleepChart(canvasId, data, config) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return;
            
            // Reverse data so oldest is on left
            const reversed = [...data].reverse();
            const labels = reversed.map(d => new Date(d['Sleep onset']).toLocaleDateString());
            let values = reversed.map(d => parseFloat(d[config.field])).filter(v => !isNaN(v));
            
            if (config.convert) {
                values = values.map(v => v / 60); // Convert minutes to hours
            }
            
            if (charts[canvasId]) {
                charts[canvasId].destroy();
            }
            
            // Calculate regression line
            const n = values.length;
            const xSum = (n * (n - 1)) / 2;
            const ySum = values.reduce((a, b) => a + b, 0);
            const xySum = values.reduce((sum, y, i) => sum + (i * y), 0);
            const xSquareSum = (n * (n - 1) * (2 * n - 1)) / 6;
            const m = (n * xySum - xSum * ySum) / (n * xSquareSum - xSum * xSum);
            const b = (ySum - m * xSum) / n;
            const regressionLine = values.map((_, i) => m * i + b);
            
            // Color based on whether higher is better for this metric
            let slopeColor;
            if (config.higherIsBetter) {
                slopeColor = m > 0 ? '#00ff88' : m < 0 ? '#ff3366' : '#a0a0a0';
            } else {
                slopeColor = m < 0 ? '#00ff88' : m > 0 ? '#ff3366' : '#a0a0a0';
            }
            
            charts[canvasId] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: config.title,
                        data: values,
                        borderColor: config.color,
                        backgroundColor: 'transparent',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: false,
                        pointRadius: 2
                    }, {
                        label: 'Trend',
                        data: regressionLine,
                        borderColor: slopeColor,
                        borderWidth: 2,
                        borderDash: [5, 5],
                        tension: 0,
                        fill: false,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: {
                            grid: { color: 'rgba(255, 255, 255, 0.05)' },
                            ticks: { color: '#a0a0a0', maxTicksLimit: 15 }
                        },
                        y: {
                            grid: { color: 'rgba(255, 255, 255, 0.05)' },
                            ticks: { color: '#a0a0a0' }
                        }
                    },
                    plugins: {
                        annotation: {
                            annotations: {
                                slope: {
                                    type: 'label',
                                    xValue: values.length - 1,
                                    yValue: regressionLine[regressionLine.length - 1],
                                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                    content: [(m > 0 ? '+' : '') + m.toFixed(2) + '/day'],
                                    color: slopeColor,
                                    font: { size: 18, weight: 'bold' },
                                    padding: 6,
                                    borderRadius: 4,
                                    position: 'end'
                                }
                            }
                        }
                    }
                }
            });
        }
        

                // Load saved data on startup
        window.addEventListener('load', () => {
            try {
                const saved = localStorage.getItem('physioData');
                if (saved) {
                    physioData = JSON.parse(saved);
                    updateHeaderInfo();
                    renderGoals();
                    renderHomeHRVChart();
                }
            } catch (e) {
                console.log('No saved data');
            }
        });
    </script>
</body>
</html>
